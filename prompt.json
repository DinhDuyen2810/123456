{
  "role": "You are a senior full-stack engineer and applied cryptography specialist. You understand Zero-Knowledge systems, End-to-End Encryption, WebCrypto API, libsodium, Supabase, and secure key management. You must prioritize security correctness over convenience.",
  "project": {
    "name": "Zero-Knowledge Encrypted Cloud Storage",
    "type": "Web Application",
    "frontend": "React",
    "backend": "Supabase",
    "goal": "Build a simple but secure Zero-Knowledge cloud system where users can store, read, and share encrypted messages/files. The cloud provider must not be able to read user data."
  },
  "security_model": {
    "zero_knowledge": true,
    "encryption_location": "client_only",
    "server_trust_level": "untrusted",
    "forbidden_actions": [
      "Server-side encryption",
      "Storing plaintext private keys",
      "Using password directly as encryption key",
      "Implementing cryptographic primitives manually"
    ]
  },
  "cryptography": {
    "libraries": [
      "libsodium-wrappers",
      "WebCrypto API"
    ],
    "algorithms": {
      "password_derivation": {
        "preferred": "Argon2id",
        "fallback": "PBKDF2",
        "purpose": "Derive a Master Key from user password"
      },
      "file_encryption": {
        "algorithm": "AES-256-GCM",
        "purpose": "Encrypt file or message content"
      },
      "key_sharing": {
        "algorithm": "ECC Curve25519",
        "purpose": "Encrypt File Key for sharing"
      },
      "digital_signature": {
        "algorithm": "Ed25519",
        "optional": true,
        "purpose": "Verify file authenticity and integrity"
      }
    }
  },
  "key_hierarchy": {
    "password": {
      "description": "User-chosen secret used only for authentication and unlocking private keys",
      "never_used_for": ["File encryption", "File sharing"]
    },
    "master_key": {
      "derived_from": "Password using Argon2id or PBKDF2",
      "used_for": ["Encrypting and decrypting user's private key"],
      "never_shared": true
    },
    "key_pair": {
      "type": "Asymmetric (Public / Private)",
      "generated": "Once per user at registration",
      "public_key_usage": ["Encrypting File Keys for sharing"],
      "private_key_usage": ["Decrypting File Keys"],
      "storage": {
        "public_key": "Stored plaintext in database",
        "private_key": "Encrypted using Master Key"
      }
    },
    "file_key": {
      "type": "Symmetric random key (256-bit)",
      "generated": "Once per file",
      "used_for": ["Encrypting file content"],
      "sharing_method": "Encrypted using recipient's Public Key",
      "never_derived_from": ["Password", "Master Key"]
    }
  },
  "user_flows": {
    "registration": [
      "User enters password",
      "Derive Master Key using KDF",
      "Generate asymmetric key pair",
      "Encrypt private key using Master Key",
      "Store public key, encrypted private key, and salt in Supabase"
    ],
    "login": [
      "User enters password",
      "Derive Master Key",
      "Decrypt private key locally",
      "No password sent to server"
    ],
    "file_upload": [
      "Generate random File Key",
      "Encrypt file using AES-GCM",
      "Encrypt File Key using user's Public Key",
      "Upload encrypted file to Supabase Storage",
      "Store encrypted File Key in database"
    ],
    "file_download": [
      "Download encrypted file and encrypted File Key",
      "Decrypt File Key using private key",
      "Decrypt file content locally"
    ],
    "file_sharing": [
      "Owner retrieves recipient's Public Key",
      "Decrypt original File Key",
      "Encrypt File Key with recipient's Public Key",
      "Store encrypted File Key for recipient",
      "Recipient decrypts File Key using own private key"
    ]
  },
  "backend_design": {
    "platform": "Supabase",
    "storage": {
      "purpose": "Store encrypted files only",
      "data_visibility": "Ciphertext only"
    },
    "database_tables": {
      "users": [
        "id",
        "public_key",
        "encrypted_private_key",
        "salt"
      ],
      "files": [
        "file_id",
        "owner_id",
        "storage_path",
        "encrypted_file_key_owner"
      ],
      "file_shares": [
        "file_id",
        "shared_with_user_id",
        "encrypted_file_key"
      ]
    }
  },
  "frontend_architecture": {
    "framework": "React",
    "design_principles": [
      "Simple UI",
      "Security-first",
      "Clear separation between crypto logic and UI"
    ],
    "modules": [
      "Authentication",
      "Key Management",
      "File Encryption",
      "File Upload/Download",
      "File Sharing"
    ]
  },
  "minimum_viable_product": {
    "required_features": [
      "User registration and login",
      "Encrypted file upload",
      "Encrypted file download",
      "File sharing between users"
    ],
    "explicitly_not_required": [
      "Homomorphic encryption",
      "Search over encrypted data",
      "Multi-device synchronization",
      "Real-time collaboration"
    ]
  },
  "output_requirements": {
    "must_include": [
      "System architecture explanation",
      "Key flow explanation",
      "React project structure",
      "Crypto usage examples",
      "Security reasoning comments"
    ],
    "code_quality": {
      "readable": true,
      "commented": true,
      "security_over_optimization": true
    }
  },
  "evaluation_criteria": {
    "zero_knowledge_correctness": true,
    "proper_key_separation": true,
    "no_password_leakage": true,
    "no_private_key_leakage": true,
    "no_server_side_crypto": true
  }
}
